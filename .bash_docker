#!/bin/bash

# Common Aliases
alias dip="docker inspect --format '{{ .NetworkSettings.IPAddress }}'"
alias dim="docker images"
alias dex="docker exec -i -t"
alias dpa="docker ps -a"
alias denv="env | grep DOCKER_"
alias dips="docker ps -q | xargs docker inspect --format '{{ .NetworkSettings.IPAddress }}  {{ .Name }} {{ .Config.Image }} {{ .State.Running }} {{ .Id }}'"
alias dstop='docker stop $(docker ps -a -q)'

# Docker Machine
function dme() {
  eval "$(docker-machine env "${1:-default}")"
}
alias dml="docker-machine ls"
alias dms="docker-machine start $1"

# Helper Functions
dcleanup(){
	docker rm -v $(docker ps --filter status=exited -q 2>/dev/null) 2>/dev/null
	docker rmi $(docker images --filter dangling=true -q 2>/dev/null) 2>/dev/null
}

# xQuartz (required for running Dockers with GUI in OS X, together with socat)
xquartz() {
	v_nolisten_tcp=$(defaults read org.macosforge.xquartz.X11 nolisten_tcp)
	v_xquartz_app=$(defaults read org.macosforge.xquartz.X11 app_to_run)

	if [ $v_nolisten_tcp == "1" ]; then
		defaults write org.macosforge.xquartz.X11 nolisten_tcp 0
	fi

	if [ $v_xquartz_app != "/usr/bin/true" ]; then
		defaults write org.macosforge.xquartz.X11 app_to_run /usr/bin/true
	fi

	netstat -an | grep 6000 &> /dev/null || open -a XQuartz
	while ! netstat -an \| grep 6000 &> /dev/null; do
		sleep 2
	done
	export DISPLAY=:0
}
    
# Common / useful Docker containers (NOT WORKING IN OS X)
speedtest() { # Speed test network connection
	docker run --name speedtext --net host --rm tianon/speedtest
}
lynx() { # Text-based web browser
	docker run --name lynx -it jess/lynx
} 
cathode() { # Old style terminal app
	docker run --name cathode -it \
	-v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=unix$DISPLAY \
	jess/1995
} 
tor() { # Tor web browser
	docker run --name tor -it \
	-v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=unix$DISPLAY \
	-v /dev/snd:/dev/snd \
	--privileged jess/tor-browser
}
chrome() { # Chrome web browser
	docker run --name chrome -it \
	--net host --cpuset 0 --memory 512mb \
	-v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=unix$DISPLAY \	
	-v $HOME/Downloads:/root/Downloads -v $HOME/.config/google-chrome/:/data \
	-v /dev/snd:/dev/snd \
	--privileged jess/chrome
}
